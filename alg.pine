//@version=5
indicator("Bollinger-Fibonacci", shorttitle="BF", overlay=true)
use_fibonacci=input.bool(true, "Fibonacci")
risk=input.float(1.0, "Risk", 1.0, 3.0)

// Bollinger Bands
_close=close
len=input.int(50, "Term", minval=20, maxval=50)
std_dev=input.float(2.0, "Standard Deviation Factor", minval=1.0, maxval=5.0)
sma=ta.sma(_close,len)
dev=std_dev*ta.stdev(_close,len)
upper=sma+dev
lower=sma-dev
plot(sma, "SMA", color=#132d72)
top=plot(upper, "UPPER", color=#2962FF, linewidth=2)
bottom=plot(lower, "LOWER", color=#2962FF, linewidth=2)
fill(top, bottom, title="BACKGROUND", color=color.rgb(33, 150, 243, 95))
// Fibonacci Retracement
src = input(hlc3, title="HLC3")
basis = ta.vwma(src, len)
_dev = (std_dev + risk) * ta.stdev(src, len)
upper_1= basis + (0.236*_dev)
upper_2= basis + (0.382*_dev)
upper_3= basis + (0.5*_dev)
upper_4= basis + (0.618*_dev)
upper_5= basis + (0.786*_dev)
upper_6= basis + (1*_dev)
lower_1= basis - (0.236*_dev)
lower_2= basis - (0.382*_dev)
lower_3= basis - (0.5*_dev)
lower_4= basis - (0.618*_dev)
lower_5= basis - (0.786*_dev)
lower_6= basis - (1*_dev)
plot(use_fibonacci ? basis : na, color=color.fuchsia, linewidth=2)
p1 = plot(use_fibonacci ? upper_1 : na, color=color.rgb(100, 100, 110), title="+0.236")
p2 = plot(use_fibonacci ? upper_2 : na, color=color.rgb(100, 100, 110), title="+0.382")
p3 = plot(use_fibonacci ? upper_3 : na, color=color.rgb(100, 100, 110), title="+0.5")
p4 = plot(use_fibonacci ? upper_4 : na, color=color.rgb(100, 100, 110), title="+0.618")
p5 = plot(use_fibonacci ? upper_5 : na, color=color.rgb(100, 100, 110), title="+0.764")
p6 = plot(use_fibonacci ? upper_6 : na, color=color.red, linewidth=2, title="+1")
p13 = plot(use_fibonacci ? lower_1 : na, color=color.rgb(100, 100, 110), title="-0.236")
p14 = plot(use_fibonacci ? lower_2 : na, color=color.rgb(100, 100, 110), title="-0.382")
p15 = plot(use_fibonacci ? lower_3 : na, color=color.rgb(100, 100, 110), title="-0.5")
p16 = plot(use_fibonacci ? lower_4 : na, color=color.rgb(100, 100, 110), title="-0.618")
p17 = plot(use_fibonacci ? lower_5 : na, color=color.rgb(100, 100, 110), title="-0.764")
p18 = plot(use_fibonacci ? lower_6 : na, color=color.green, linewidth=2, title="-1")
